<!DOCTYPE html>
<html lang="es">
	<head>
	  <title>Form</title>
	  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
	  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
<!-- 	  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet"> -->
<!-- 	  <script type="text/javascript" src="/webdesk/vcXMLRPC.js" charset="utf-8"></script> -->
	<link href="./css/vuetify.min.css" rel="stylesheet">
	  <link href="./css/materialdesignicons.min.css" rel="stylesheet">
	  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
	  <meta charset="UTF-8">
	</head>
 	<body>
		  <div id="app">
		    <form id="totForm" name="totForm">
		      <input type="hidden" name="__error" id="__error" />
<input type="hidden" id="requestId" name="requestId" ref="requestId"></input>
			  <input type="hidden" name="numero_cotizacion" id="numero_cotizacion" ref="numero_cotizacion"/>
			  <input type="hidden" id="jsonModel_1" name="jsonModel_1" ref="jsonModel_1"></input>
			  <input type="hidden" id="jsonModel_2" name="jsonModel_2" ref="jsonModel_2"></input>
			  <input type="hidden" id="jsonModel_3" name="jsonModel_3" ref="jsonModel_3"></input>
			  <input type="hidden" id="jsonModel_4" name="jsonModel_4" ref="jsonModel_4"></input>
			  <input type="hidden" id="jsonModel_5" name="jsonModel_5" ref="jsonModel_5"></input>
			  <input type="hidden" id="jsonModel_6" name="jsonModel_6" ref="jsonModel_6"></input>
			  <input type="hidden" id="jsonModel_7" name="jsonModel_7" ref="jsonModel_7"></input>
			  <input type="hidden" id="jsonModel_8" name="jsonModel_8" ref="jsonModel_8"></input>
			  <input type="hidden" id="jsonModel_9" name="jsonModel_9" ref="jsonModel_9"></input>
			  <input type="hidden" id="jsonModel_10" name="jsonModel_10" ref="jsonModel_10"></input>
			  <input type="hidden" id="jsonModel_11" name="jsonModel_11" ref="jsonModel_11"></input>
			  <input type="hidden" id="jsonModel_12" name="jsonModel_12" ref="jsonModel_12"></input>
			  <input type="hidden" id="jsonModel_13" name="jsonModel_13" ref="jsonModel_13"></input>
			  <input type="hidden" id="jsonModel_14" name="jsonModel_14" ref="jsonModel_14"></input>
			  <input type="hidden" id="jsonModel_15" name="jsonModel_15" ref="jsonModel_15"></input>
			  <input type="hidden" id="jsonModel_16" name="jsonModel_16" ref="jsonModel_16"></input>
			  <input type="hidden" id="jsonModel_17" name="jsonModel_17" ref="jsonModel_17"></input>
			  <input type="hidden" id="jsonModel_18" name="jsonModel_18" ref="jsonModel_18"></input>
			  <input type="hidden" id="jsonModel_19" name="jsonModel_19" ref="jsonModel_19"></input>
			  <input type="hidden" id="jsonModel_20" name="jsonModel_20" ref="jsonModel_20"></input>
			  <input type="hidden" id="jsonModel_21" name="jsonModel_21" ref="jsonModel_21"></input>
			  <input type="hidden" id="jsonModel_22" name="jsonModel_22" ref="jsonModel_22"></input>
			  <input type="hidden" id="jsonModel_23" name="jsonModel_23" ref="jsonModel_23"></input>
			  <input type="hidden" id="jsonModel_24" name="jsonModel_24" ref="jsonModel_24"></input>
			  <input type="hidden" id="jsonModel_25" name="jsonModel_25" ref="jsonModel_25"></input>
			  <input type="hidden" id="jsonModel_26" name="jsonModel_26" ref="jsonModel_26"></input>
			  <input type="hidden" id="jsonModel_27" name="jsonModel_27" ref="jsonModel_27"></input>
			  <input type="hidden" id="jsonModel_28" name="jsonModel_28" ref="jsonModel_28"></input>
			  <input type="hidden" id="jsonModel_29" name="jsonModel_29" ref="jsonModel_29"></input>
			  <input type="hidden" id="jsonModel_30" name="jsonModel_30" ref="jsonModel_30"></input>
		    </form>
			
		    <v-app>
				<v-main>
					<v-form  ref="formvue" v-model="valid" lazy-validation>
						<!-- ===============   DATOS DE CABECERA  =================== -->

						
						<v-card  class="mx-3 mb-3 d-flex justify-center align-center"> 
							
							<v-form class="mt-5" style="width: 90%;">
								
								<v-row>
									
									<v-card-title>
										Datos Generales
									</v-card-title>
								
								<v-spacer></v-spacer>

									<v-btn class="mt-4 mr-2" variant="tonal" @click="dialogHistorial = true">
										Ver Historial
									</v-btn>
								
								</v-row>
								<!-- ===============   VENTANA HISTORIAL  =================== -->
								<v-dialog v-model="dialogHistorial" width="1100" height="1100" persistent>
									<v-card>

								<v-container>
									<v-row>
									<v-card-title>Historial Cotizaciones</v-card-title>
									<v-spacer></v-spacer>
									<v-col class="d-flex justify-end" cols="12" sm="3" md="3">
											<v-text-field v-model="search" append-icon="mdi-magnify" label="Buscar" single-line variant="outlined" hide-details></v-text-field>
										</v-col>
									</v-row>
								</v-container>
							
								<!-- <v-data-table :headers="headersHistorial" :items="itemsHistorial" :search="search" class="elevation-1 pa-2" item-key="name" no-data-text="No hay datos" mobile-breakpoint="0" style="width:100%;"> -->
								<v-data-table :headers="headersHistorial" :items="itemsHistorial" :search="search" :custom-filter="customFilter" class="elevation-1 pa-2" item-key="name" no-data-text="No hay datos" mobile-breakpoint="0" style="width:100%;">
										<template v-slot:item="{ item, headers }">
											<tr>
												<td v-for="header in headers" :key="header.value"
													:class="{'text-center': header.align === 'center', 'text-end': header.align === 'end'}">
																										<template v-if="header.type === 'icon'"> 
													<v-icon medium @click="copyItem(item)" v-show="!viewMode">
														mdi-content-copy
													</v-icon>
													</template>
												<template v-else>
													<template v-if="header.value === 'cliente'">
														{{ item.razSoc }}
													</template>
													<template v-if="header.value === 'vendedor'"> 
															{{ item.codVendedor }}
														</template>
														<template v-if="header.value === 'fechEmis'"> 
															{{ item.fecha }}
														</template>
														<template v-if="header.value === 'fechSeg'"> 
														{{ item.fechaSeg }}
													</template>
													<template v-if="header.value === 'tipCotiz'"> 
															{{ item.tipoCotiz }}
														</template>
														<template v-if="header.value === 'cotizAsoc'"> 
															{{ item.cotizAsoc }}
														</template>
																											</template>
												</td>
											</tr>
										</template>
										<template v-slot:no-results>
											<v-alert :value="true" color="error" icon="mdi-alert">
											No se encontraron coincidencias con "{{ search }}".
											</v-alert>
										</template>
									</v-data-table>

									<v-divider></v-divider>
									<v-card-actions>
										<v-spacer></v-spacer>
										<v-btn @click="dialogHistorial = false">Cerrar</v-btn>
									</v-card-actions>
								</v-dialog>
								<!-- ===============   FIN VENTANA DE HISTORIAL  =================== -->
								<br>
								<hr>
								<br>

								<v-row class='mb-2'>
									
									<v-col cols="12" md="3">
										<v-text-field label="Numero Cotizacion" v-model="model.numcotiz" hide-details=true disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="Fecha de Emision" v-model="model.fecha" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="Cotización Asociada" v-model="model.cotizAsoc" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="Revisión" v-model="model.revision" hide-details disabled outlined></v-text-field>
									</v-col>
								</v-row>
								
								

								<v-row class='mb-2'>

									<v-col cols="12" md="4">
										<v-select 
											label="Tipo de Cotización" type="input" :items="['Nacional', 'Comex', 'Budgetaria Nacional', 'Budgetaria Comex']" v-model="model.tipoCotiz" :disabled="viewMode" outlined 
										></v-select>
									</v-col>


									<v-col cols="12" md="4">

										<v-autocomplete label="Moneda" :items="monedas" auto-select-first item-text="desc" item-value="desc"
										v-model="model.moneda" hide-details=true :disabled="viewMode" outlined :rules="required" >
											
											<template v-slot:item="{ item }">
												<div>{{ item.symb }} - {{ item.desc }}</div>
											</template>
										
										</v-autocomplete>
									</v-col>

									<v-col cols="12" md="4">
										
										<v-autocomplete label="Método de Pago" :items="paidmetods" auto-select-first item-text="desc" item-value="desc"
										v-model="model.metodoPago" hide-details=true :disabled="viewMode" outlined :rules="required" ></v-autocomplete>
									</v-col>

								</v-row>
								
								<v-row class='mb-2'>
									
									<v-col cols="12" md="3">

										<v-autocomplete label="Codigo Cliente" :items="clientesMod" auto-select-first item-text="claveClientes" item-value="cod"
										@change="getClientSelect($event)" v-model="model.codCli" hide-details=true :disabled="viewMode" outlined >

											<template v-slot:item="{ item }">
												<div>{{ item.cod }} - {{ item.name }}</div>
											</template>

										</v-autocomplete>

									</v-col>
									
									<v-col cols="12" md="4">
										<v-text-field type="input" label="Razón Social Cliente" v-model="model.razSoc" hide-details :disabled="viewTrigger||viewMode" outlined :rules="required"></v-text-field>
										
									</v-col>
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="CUIT Cliente" v-model="model.CUITCli" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="2">
										<v-text-field type="input" label="Descuento Cliente" v-model="model.dtoCliente" hide-details :disabled="viewMode" outlined></v-text-field>
									</v-col>
									
								</v-row>
								

								<v-row class='mb-2'>

									<v-col cols="12" md="3">
										<v-text-field type="input" label="Fecha de Seguimiento" v-model="model.fechaSeg" hide-details :disabled="!viewConfir" outlined ></v-text-field>
									</v-col>

									<v-col cols="12" md="3">
										<v-text-field type="input" label="Plazo de Seguimiento" v-model="model.plazoSeg" hide-details :disabled="viewMode" outlined></v-text-field>
									</v-col>

									<v-col cols="12" md="4">
										
										<v-autocomplete label="Lista de Precio" :items="priceList" auto-select-first item-text="cod_lista" item-value="cod_lista"
										@change="refreshPrecio($event)" v-model="model.listaPrecio" hide-details=true :disabled="viewMode" outlined :rules="required" ></v-autocomplete>
									</v-col>
									
									<v-col cols="12" md="2">
										<v-text-field type="input" label="Descuento Adicional" v-model="model.dtoAdicional" hide-details :disabled="viewMode" outlined></v-text-field>
									</v-col>
									
								</v-row>

								
								<v-row class='mb-2'>
									<v-col cols="12" md="4">
										
										<v-autocomplete label="Vendedor" :items="sellersMod" auto-select-first  item-text="claveSellers" item-value="cod"
										v-model="model.codVendedor" hide-details=true :disabled="viewMode" outlined :rules="required" >
										
											<template v-slot:item="{ item }">
												<div>{{ item.cod }} - {{ item.name }}</div>
											</template>
									
										</v-autocomplete>
									
									</v-col>
									
									<!-- v-if="WKNumState == 0" -->
									<v-col cols="12" md="2">
										<v-text-field type="input" label="Plazo de entrega Global"  @change="refreshPlazo($event)" v-model="model.plazo_ent_gbl" hide-details :disabled="viewMode" outlined :rules="[validaPlazos]"></v-text-field>
									</v-col>
									
									<v-col cols="12" md="2">
										<v-checkbox  label="Pedido Crítico "  v-model="model.ped_crit" color="secondary"  hide-details></v-checkbox>
										
									</v-col>
									<v-col cols="12" md="2">
										
										<v-checkbox  label="Posee Multas " v-model="model.multas"  color="secondary" hide-details></v-checkbox>
									</v-col>

									
								</v-row>


								
							</v-form>
						</v-card>
						

						<!-- ===============   ITEMS =================== -->


						<v-card  class="mx-3 mb-3 d-flex justify-center align-center flex-column">
							<v-form class="mt-5" style="width: 90%;">
								<v-row>
									<v-card-title> Items </v-card-title>
								</v-row>
								<hr>
							</v-form>
							<v-data-table :headers="headersPrincipal" :items="model.itemsPrincipal" class="elevation-1 pa-2" item-key="name" no-data-text="No hay datos" mobile-breakpoint="0" style="width:100%;" hide-default-footer disable-pagination>
								<template v-slot:item="{ item, headers }">
									<tr>
										<td v-for="header in headers" :key="header.value"
											:class="{'text-center': header.align === 'center', 'text-end': header.align === 'end'}">
											<template v-if="header.type === 'input'">
												<v-text-field v-if="header.value === 'plazo_entrega'" :type="header.inputType" v-model="item[header.value]" class="text-center" :disabled="!item.mejora_plazo||!viewPlazo" :rules="required"></v-text-field>
												<v-text-field v-else-if="header.value === 'cantidad'" :type="header.inputType" @change="totalCalc(item)" v-model="item[header.value]" class="text-center" :disabled="header.disabled" :rules="required"></v-text-field>
												<v-text-field v-else-if="header.value === 'desc_adic'" :type="header.inputType" @change="totalCalc(item)" v-model="item[header.value]" class="text-center" :disabled="header.disabled" :rules="required"></v-text-field>
												<v-text-field v-else-if="header.value === 'item'" :type="header.inputType" v-model="item[header.value]" class="text-center" :disabled="header.disabled" :rules="required"></v-text-field>
												<v-text-field v-else :type="header.inputType" v-model="item[header.value]" class="text-center" :disabled="header.disabled" ></v-text-field>
											</template>
											<template v-else-if="header.type === 'v-autocomplete'">
												
												<v-autocomplete label="Seleccione un producto" :items="productosMod" auto-select-first item-text="claveProd" item-value="descripcion"
													@change="getProdSelect(item)" v-model="item[header.value]" hide-details=true :disabled="header.disabled" outlined :rules="required" >

													<template v-slot:item="{ item }">
														<div>{{ item.descripcion }}    ||    {{ item.grupo }}    ||    {{ item.codigo }}</div>
													</template>

												</v-autocomplete>


											</template>

											<template v-else-if="header.type === 'checkbox'">
												<v-checkbox v-model="item[header.value]" :disabled="header.disabled"></v-checkbox>
											</template>
											
											<template v-else-if="header.type === 'icon'"> 
											<v-icon small @click="deleteItem(item)" v-show="!viewMode">
												mdi-delete
											</v-icon>
											</template>
											<template v-else>
												{{ item[header.value] }}
											</template>
										</td>
									</tr>
								</template>

								<template slot="body.append">
									<tr disabled>
									<th colspan="10"></th>
									<th class="title">Subtotal</th>
									<th class="title">{{sumSubTotal('precio_lista', 'cantidad')}}</th>
									</tr>
									<tr>
									<th colspan="10"></th>
										<th class="title">Total</th>
									<th class="title">{{sumTotal('importe')}}</th>
									</tr>
														</template>
							</v-data-table>
							
							<div class="pa-3 d-flex justify-end" v-if="!viewMode" style="width: 100%;">
								<v-btn class="bg-primary mx-5" id="btnAprueba" value="aprobado" @click="addItemPrincipal()">
								Agregar
								</v-btn>
							</div>


						</v-card>




						<!-- ===============   COMEX =================== -->
						

						<v-card v-if="model.tipoCotiz == 'Comex' || model.tipoCotiz == 'Budgetaria Comex'"  class="mx-3 mb-3 d-flex justify-center align-center"> 
							
							<v-form class="mt-5" style="width: 90%;" >
								
								<v-card-title> COMEX </v-card-title>

								<hr>
								<br>

								<v-row class='mb-6'>
									<v-col cols="12" md="6">
										<v-text-field type="input" label="Ciudad" v-model="model.comex_ciudad" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="6">
										<v-text-field type="input" label="Pais" v-model="model.comex_pais" hide-details=true :disabled="viewMode" outlined></v-text-field>
									</v-col>
								</v-row>
								
								<v-row class='mb-6'>
									
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="Gastos Administrativos" v-model="model.comex_gastosadm" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="NCM" v-model="model.comex_ncm" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="Incoterms" v-model="model.comex_incoterms" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="Aduana" v-model="model.comex_aduana" hide-details disabled outlined></v-text-field>
									</v-col>


								</v-row>


								<v-row class='mb-6'>	


									<v-col cols="12" md="4">
										<v-text-field type="input" label="Peso" v-model="model.comex_peso" hide-details disabled outlined></v-text-field>
									</v-col>

									<v-col cols="12" md="4">
										<v-text-field type="input" label="Volumen" v-model="model.comex_vol" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="4">
										<v-text-field type="input" label="Tipo Flete" v-model="model.comex_flete" hide-details disabled outlined></v-text-field>
									</v-col>

								</v-row>

								<v-row class='mb-6'>

									<v-col cols="12" md="3">
										<v-text-field type="input" label="Valor Flete Local" v-model="model.comex_valfleteloc" hide-details disabled outlined></v-text-field>
									</v-col>

									<v-col cols="12" md="3">
										<v-text-field type="input" label="Valor Flete Internacional" v-model="model.comex_valfleteint" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="Valor Seguro" v-model="model.comex_valseg" hide-details disabled outlined></v-text-field>
									</v-col>
									
									<v-col cols="12" md="3">
										<v-text-field type="input" label="Valor FOB" v-model="model.comex_valfob" hide-details disabled outlined></v-text-field>
									</v-col>
								</v-row>

								
							</v-form>
						</v-card>


						<!-- ===============   DETALLES =================== -->

					<v-card class="mx-3 mb-3 d-flex justify-center align-center">
						<v-form class="mt-5" style="width: 90%;">
							<v-card-title>
								Detalles
							</v-card-title>
							<hr>
							<br>
							<v-row>
								<template>
									<v-container fluid>
										<v-textarea label="Observaciones generales" v-model="model.obsGen" :disabled="viewMode" outlined></v-textarea>
									</v-container>
									<v-container fluid>
										<v-textarea label="Observaciones comercial" v-model="model.obsCom" :disabled="viewMode" outlined></v-textarea>
									</v-container>
								</template>

							</v-row>
						
						</v-form>

					</v-card>

				</v-main>
		    </v-app>
		  </div>			
			
		  <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script> -->
		  <!-- <script src="https://cdn.jsdelivr.net/npm/vuex@3.6.2/dist/vuex.min.js"></script> -->
		  <!-- <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script> -->
		  <!-- <script src="https://cdn.jsdelivr.net/npm/v-mask@2.3.0/dist/v-mask.min.js"></script> -->
		  
		  	<script src="./js/vue.js"></script>
			<script src="./js/vuetify.js"></script>
			<script src="./js/vuex.min.js"></script>
			<script src="./js/v-mask.min.js"></script>
		  
		  <script src="/portal/resources/js/jquery/jquery.js"></script>
		  <script src="/portal/resources/js/jquery/jquery-ui.min.js"></script>
		  <script src="/portal/resources/js/mustache/mustache-min.js"></script>
		  
		  <script src="/tot-marvin-v1/ui/tot-marvin-ui.min.js"></script>
		  <script type="text/javascript" src="/webdesk/vcXMLRPC.js" charset="utf-8"></script>
		  <script src="utils.js"></script>
		  <!-- 		  <script src="vue-datetime.js"></script> -->
		  <script src="cHeader.js"></script>
		  <script src="cForm.js"></script>
		  <script src="cTabla.js"></script>
	      <script src="custom.js"></script>
	
		  <style type="text/css">
		    .text-right .v-text-field__slot input {
		      text-align: right;
		    }
		  </style>
		  
		  <style scoped>
			.filtro {
			  box-shadow: 0px 0px 1px -1px rgba(0, 0, 0, 0.2), 
			  			  0px 0px 1px 0px rgba(0, 0, 0, 0.14), 
			  			  0px 0px 3px 0px rgba(0, 0, 0, 0.12) !important;
			}
		  </style>
	</body>
</html>